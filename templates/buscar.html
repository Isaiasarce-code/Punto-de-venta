<!doctype html>
<html>
<head>
    <title>Buscar producto</title>
</head>
    <script>
function actualizarTotal(precio, id) {
    const cantidad = document.getElementById(`cantidad${id}`).value;
    const total = parseFloat(precio) * parseFloat(cantidad || 0);
    document.getElementById(`total${id}`).innerText = total.toFixed(2);
}
</script>

<body>
    {% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul>
    {% for message in messages %}
      <li><strong>{{ message }}</strong></li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

    <h2>Buscar producto</h2>

    <form method="post">
        <label>C贸digo de barras:</label>
        <input type="text" name="codigo">
        <br>
        <label>Descripci贸n del producto:</label>
        <input type="text" name="descripcion">
        <br>
        <button type="submit">Buscar</button>
    </form>

    {% if error %}
        <p style="color:red">{{ error }}</p>
    {% endif %}

    {% if productos is not none and not productos.empty %}
        <h3>Resultados:</h3>
       <table border="1">
    <tr>
        <th>C贸digo</th>
        <th>Descripci贸n</th>
        <th>Precio</th>
        <th>Cantidad</th>
        <th>Total</th>
        <th>Vender</th>
    </tr>
    {% for i, prod in productos.iterrows() %}
    <tr>
        <form action="/vender" method="post">
            <td>{{ prod['codigo'] }}</td>
            <td>{{ prod['descripcion'] }}</td>
            <td id="precio{{ i }}">{{ prod['precio'] }}</td>
            <td>
                <input
                    type="number"
                    name="cantidad"
                    id="cantidad{{ i }}"
                    min="1"
                    value="1"
                    oninput="actualizarTotal({{ prod['precio'] }}, '{{ i }}')"
                    required
                >
                <input type="hidden" name="codigo" value="{{ prod['codigo'] }}">
            </td>
            <td><span id="total{{ i }}">{{ "%.2f"|format(prod['precio']) }}</span></td>
            <td><button type="submit">Vender</button></td>
        </form>
    </tr>
    {% endfor %}
</table>

    {% endif %}
</body>
</html>

